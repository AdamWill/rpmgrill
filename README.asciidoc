RPMGrill
========
:doctype: book
:toc:
:lang: en

Overview
--------

image:https://travis-ci.org/default-to-open/rpmgrill.svg?branch=master["Build Status", link="https://travis-ci.org/default-to-open/rpmgrill"]

This is rpmgrill, a set of analysis tests that run against a
particular RPM build. It principally differs from
https://fedoraproject.org/wiki/Common_Rpmlint_issues[rpmlint]
in that rpmgrill handles *builds*, that is, the entire set of
RPMs built from one source RPM.

For example, rpmgrill can warn about missing man pages; "make" errors
or warnings buried in the build logs; or common spec file mistakes.
rpmgrill does not know about baselines or previous builds; it does
no comparisons, only isolated analysis of one build.

Testing Your Builds
-------------------

Terminology
~~~~~~~~~~~

A *build* refers to a collection of RPMs built from a single
source RPM (which is included in the build). For purposes of
this document, builds are assumed to be generated by
http://koji.fedoraproject.org/koji/[koji].

Invoking
~~~~~~~~

The rpmgrill tool tests not only RPM files themself, but also auxiliary files
(e.g. the build log). The simplest way to start is to use the
`rpmgrill-fetch-build` command which automatically downloads necessary files for
testing from Fedora's Koji instance:

[source,bash]
----
$ export NVR=coreutils-8.15-10.fc17
$ rpmgrill-fetch-build $NVR my-$NVR
$ rpmgrill my-$NVR
----

rpmgrill runs silently, although there may be occasional output
to stdout or stderr during development of tests. These messages are
not preserved anywhere; they are intended for development and for
detecting rare problems.

Results
~~~~~~~

Three data files, same thing in different formats:

    rpmgrill.json
    rpmgrill.xml
    rpmgrill.yaml

These files contain standard information describing the build
being tested (N-V-R, data analyzed, version of the tools) and
zero or more reports from failing tests.

Retrieving Builds from Koji
---------------------------

Builds can be retrieved with the `bin/rpmgrill-fetch-build` command:

[source,bash]
----
# by default uses Fedora's Koji instance to retrieve builds from
$ bin/rpmgrill-fetch-build ldapvi-1.7-20.fc22 ldapvi

# previous command is equivalent to
$ bin/rpmgrill-fetch-build \
  --server-url http://koji.fedoraproject.org/kojihub \
  --top-url http://kojipkgs.fedoraproject.org \
  ldapvi-1.7-20.fc22 ldapvi

# use other koji instances, e.g. CentOS
$ bin/rpmgrill-fetch-build \
  --server-url=http://cbs.centos.org/kojihub/ \
  --top-url=http://cbs.centos.org/kojifiles \
  ebay-cors-filter-1.0.1-3.el7 ebay-cors-filter
----

How to Debug Problems Fetching Builds
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If the script returns an error, you can use two arguments to control the
output from the script and Koji, which may provide valuable information
debugging the problem.

You can use:

`--debug`::
    This prints the XML send and received from Koji.

`--verbose`::
    This provides verbose output as to what is happening and where
    builds are stored.

Development
-----------

To add, extend, or fix individual rpmgrill tests see README.devel-tests

For deeper development, such as ongoing maintenance or infrastructure
development (or perhaps infrastructure bug fixes), see README.devel-deep

Reporting Bugs
~~~~~~~~~~~~~~

Please report bugs or issues against
https://bugzilla.redhat.com/enter_bug.cgi?product=rpmgrill[rpmgrill] in
Bugzilla.

You can browse existing bugs filed against the
https://bugzilla.redhat.com/buglist.cgi?quicksearch=product%3AFedora%20component%3Arpmgrill&list_id=7668781[rpmgrill
Fedora package] or
https://bugzilla.redhat.com/buglist.cgi?quicksearch=product%3Arpmgrill&list_id=7668786[rpmgrill]
itself.

Nightly Builds
--------------

Easy installable packages are available via
https://copr.fedorainfracloud.org/coprs/romanofski/rpmgrill/[Fedora copr].
